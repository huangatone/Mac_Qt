<!DOCTYPE html>
<html>
<head>
<title></title>
<style type="text/css">
        body
        {
        margin:0;
        padding:0;
        }
        #div1
        {
        width:25%;
        float:left;
        height:100%;
        position:absolute;
        }
        #div2
        {
        width:75%;
        background-color:#000022;
        float:left;
        height:100%;
        position:absolute;
        }
        #map {
        height: 60%;
        width: 100%
        }
        #splitter
        {
        width:10px;
        background-color:#002200;
        float:left;
        height:100%;
        position:absolute;
        cursor:w-resize;
        }


</style>
<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCQMC-XDcbgfPtySwq9J4AL2uG8tZXuTUo&callback=initMap"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.10.8/xlsx.full.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.6/angular.min.js"></script>
<script >
	var splitter,cont1,cont2;
	var last_x,window_width;
	var map ;
	var markersB17_Config = [];
	var markersB17_Install = [];
	var markersB17_NO = [];
	
	var markersB14 = [];
	
	function getCircle(magnitude) {
        return {
          path: google.maps.SymbolPath.CIRCLE,
          fillColor: 'red',
          fillOpacity: .6,
          scale: Math.pow(2, magnitude) / 2,
          strokeColor: 'white',
          strokeWeight: .5
        };
      }
	  
	function init()
	{
		window_width=window.innerWidth;
		splitter=document.getElementById("splitter");
		cont1=document.getElementById("div2");
		cont2=document.getElementById("div1");
		var dx=cont1.clientWidth;
		splitter.style.marginLeft=dx+"px";
		dx+=splitter.clientWidth;
		cont2.style.marginLeft=dx+"px";
		dx=window_width-dx;
		cont2.style.width=dx+"px";
		splitter.addEventListener("mousedown",spMouseDown);

	}

	function spMouseDown(e)
	{
		splitter.removeEventListener("mousedown",spMouseDown);
		window.addEventListener("mousemove",spMouseMove);
		window.addEventListener("mouseup",spMouseUp);
		last_x=e.clientX;
	}

	function spMouseUp(e)
	{
		window.removeEventListener("mousemove",spMouseMove);
		window.removeEventListener("mouseup",spMouseUp);
		splitter.addEventListener("mousedown",spMouseDown);
		resetPosition(last_x);
	}

	function spMouseMove(e)
	{
		resetPosition(e.clientX);
	}

	function resetPosition(nowX)
	{
		var dx=nowX-last_x;
		dx+=cont1.clientWidth;
		cont1.style.width=dx+"px";
		splitter.style.marginLeft=dx+"px";
		dx+=splitter.clientWidth;
		cont2.style.marginLeft=dx+"px";
		dx=window_width-dx;
		cont2.style.width=dx+"px";
		last_x=nowX;
		google.maps.event.trigger(map, "resize");
	}

	function initMap() 
	{
		map = new google.maps.Map(document.getElementById('div2'), {
		zoom: 8,
        center: {lat:43.643794, lng:-79.613486}
		});
	}
	
	//create a marker
	function createMarker(group,name,lng,lat)
	{
		var latLng = new google.maps.LatLng(  lat,lng);
		var image = 'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png';
		var marker = new google.maps.Marker({
				position: latLng,
				map: null,
				label: name,
				icon: getCircle(5)
			  });
		group.push(marker);
	}
	// Removes/shows the markers from the map, but keeps them in the array.
	function showMarkers(group,m)
	{
		for (var i = 0; i < group.length; i++)
		{
			group[i].setMap(m);
		}
	}
	
				
	 //checkbox click event
	function handleClick(cb,group)
	{
		var p = null;
		if(cb.checked)
		{
			p = map;			
		}
		showMarkers(group,p);
	}
	//------------ read xml file ------------------------------
    function ExcelExport(event) 
    {   
    var group = new Array();
	var name ;
	var band;
	
	var tput;
	var lng;
	var lat;
	
    var index = 0;
    var input = event.target;
    var reader = new FileReader();
    reader.onload = function()
    {
        var fileData = reader.result;
        var wb = XLSX.read(fileData, {type : 'binary'});

		// --------------- read every sheet ----------------------------------------------
        wb.SheetNames.forEach(function(sheetName){
        var rowObj =XLSX.utils.sheet_to_row_object_array(wb.Sheets[sheetName]);
        var jsonObj = JSON.stringify(rowObj);
        // ----------------- read every cell ----------------------------------------------
        JSON.parse(jsonObj, (key, value) => {
              //console.log(key); // log the current property name, the last is "".
              
              if( key.trim() == "ENUM")
			  {
				name = value;				
			  }
              else if(key.trim() == "B17")
              {
				band = value;                 
              }
			  else if( key.trim() == "Long")
			  {
				lng = value;
			  }
			  else if(key.trim() == "Lat" )//&& tput < 3000
			  {
				lat = value;
				
				//todo
				
				if(band.trim()  == "B17 configured")
				{
					//if(tput > 300)			
					createMarker(markersB17_Config,name,lng,lat);
					band = "";
				}
				else if(band.trim() == "B17 Installed")
				{
				//if(tput > 300)
				console.log("Installed ---" + name + " " + lng + " " + lat);
				console.log( "band = " + band);
					createMarker(markersB17_Install,name,lng,lat);
					band = "";
				}
				else if(band.trim() == "B17 No")
				{
				//if(tput > 300)
					createMarker(markersB17_NO,name,lng,lat);
					band = "";
				}
				else if (key.trim() == "Estimated" )
				tput = value;
			}
			
			  // and so on;
			  
              //console.log(value);
              //console.log('---------------\n');
              return value;     // return the unchanged property value.
            });
        console.log(jsonObj)
        console.log('---------------\n');
        })

         console.log('items size = ' + group.length);
        for(var i= 0, l = group.length; i< l; i++)
        {
           console.log( 'item  = ' + group[i]);
        }
    };

    var res = reader.readAsBinaryString(input.files[0]);

    console.log('---------------\n');
   

  
}


	


</script>
</head>
<body onload="init();">

        <div id="div2"></div>
		<div id="splitter"></div>
        <div id="div1">
        <form >      
          <input type="file" id="file" ng-model="csvFile"  onchange='ExcelExport(event)'/>
        </form>
		<h2 id = "lowband"> High Band </h2>
		<table border = 1>
			<tr> 
				<td> Band <td > Config <td> Installed <td> NO
			</tr>
			
			<tr>
			    <td> B17 <td> <input type="checkbox"  name="vehicle" value="" onclick='handleClick(this,markersB17_Config);'>  
				<td> <input type="checkbox" name="vehicle" value="" onclick='handleClick(this,markersB17_Install);'>
				<td> <input type="checkbox" name="vehicle" value="" onclick='handleClick(this,markersB17_NO);'>
			</tr>
			
			<tr>
			    <td> B4 <td> <input type="checkbox"  name="vehicle" value="" onclick='handleClick(this,markersB17_Config);'>  
				<td> <input type="checkbox" name="vehicle" value="" onclick='handleClick(this,markersB17_Install);'>
				<td> <input type="checkbox" name="vehicle" value="" onclick='handleClick(this,markersB17_NO);'>
			</tr>
			
		</table>
		
		
		<h2 id = "highband"> High Band </h2>
		
		<table border = 1>
			<tr> 
				<td> Band <td > Config <td> Installed <td> NO
			</tr>
			
			<tr>
			    <td> B17 <td> <input type="checkbox"  name="vehicle" value="" onclick='handleClick(this,markersB17_Config);'>  
				<td> <input type="checkbox" name="vehicle" value="" onclick='handleClick(this,markersB17_Install);'>
				<td> <input type="checkbox" name="vehicle" value="" onclick='handleClick(this,markersB17_NO);'>
			</tr>
			
			<tr>
			    <td> B4 <td> <input type="checkbox"  name="vehicle" value="" onclick='handleClick(this,markersB17_Config);'>  
				<td> <input type="checkbox" name="vehicle" value="" onclick='handleClick(this,markersB17_Install);'>
				<td> <input type="checkbox" name="vehicle" value="" onclick='handleClick(this,markersB17_NO);'>
			</tr>
			
		</table>
		
        </div>
        
<script type="text/javascript">

</script>
</body>
</html>>


